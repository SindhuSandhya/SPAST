<div class="container-fluid">
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Debug Info (Remove in production) -->
  <div class="alert alert-info" style="display: none;">
    <strong>Debug Info:</strong>
    <pre>{{ dashboardStats | json }}</pre>
  </div>

  <!-- Page Header -->


  <!-- Statistics Cards -->
  <div class="row">
    <!-- Admin View Stats -->
    <ng-container *ngIf="adminDashboardStats.totalTenants > 0">
      <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Total Tenants</p>
                <h4 class="mb-0">{{ adminDashboardStats.totalTenants }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-primary mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-building font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Total Cases</p>
                <h4 class="mb-0">{{ adminDashboardStats.totalCases }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-success mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-briefcase font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Active Tenants</p>
                <h4 class="mb-0">{{ adminDashboardStats.activeTenants }}</h4>
                <!-- <p class="text-muted mb-0">{{ ((adminDashboardStats.activeTenants / adminDashboardStats.totalTenants) * 100) | number:'1.0-0' }}%</p> -->
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-warning mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-check-circle font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Avg. Cases/Tenant</p>
                <h4 class="mb-0">{{ adminDashboardStats.averageCasesPerTenant }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-info mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-chart-line font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Max Cases</p>
                <h4 class="mb-0">{{ adminDashboardStats.maxCases }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-danger mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-trending-up font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Min Cases</p>
                <h4 class="mb-0">{{ adminDashboardStats.minCases }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-secondary mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-trending-down font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Regular User View Stats (fallback) -->
    <ng-container *ngIf="adminDashboardStats.totalTenants === 0">
      <div class="col-xl-2 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Total Candidates</p>
                <h4 class="mb-0">{{ dashboardStats.totalCandidates }}</h4>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-primary mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-account-multiple font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Completed</p>
                <h4 class="mb-0">{{ dashboardStats.completed }}</h4>
                <p class="text-muted mb-0">{{ dashboardStats.completionPercentage }}%</p>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-success mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-check-circle font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Pending</p>
                <h4 class="mb-0">{{ dashboardStats.pending }}</h4>
                <p class="text-muted mb-0">{{ dashboardStats.pendingPercentage }}%</p>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-warning mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-clock-outline font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-2 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Failed</p>
                <h4 class="mb-0">{{ dashboardStats.failed }}</h4>
                <p class="text-muted mb-0">{{ dashboardStats.failedPercentage }}%</p>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-danger mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-close-circle font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-4 col-md-6">
        <div class="card mini-stats-wid">
          <div class="card-body">
            <div class="d-flex">
              <div class="flex-grow-1">
                <p class="text-muted fw-medium">Avg. Days</p>
                <h4 class="mb-0">{{ dashboardStats.avgDays }}</h4>
                <p class="text-muted mb-0">Completion Time</p>
              </div>
              <div class="flex-shrink-0 align-self-center">
                <div class="avatar-sm rounded-circle bg-info mini-stat-icon">
                  <span class="avatar-title">
                    <i class="mdi mdi-timer-sand font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Admin Tenant Bar Chart Section -->
  <div class="row" *ngIf="adminDashboardStats.totalTenants > 0">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title mb-0">Tenant Cases Breakdown</h4>
        </div>
        <div class="card-body">
          <div id="tenantChartDiv" style="width: 100%; height: 500px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Verification Type Statistics -->
  <div class="row" *ngIf="adminDashboardStats.totalTenants === 0">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title mb-0">Verification Type Statistics</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-xl-3 col-md-6" *ngFor="let key of getVerificationKeys()">
              <div class="card border-0 shadow-none">
                <div class="card-body p-3">
                  <div class="d-flex align-items-center mb-3">
                    <div class="avatar-sm rounded bg-soft-{{ getVerificationColorClass(key) }} flex-shrink-0 me-3">
                      <i class="mdi {{ getVerificationIcon(key) }} font-size-20 text-{{ getVerificationColorClass(key) }}"></i>
                    </div>
                    <h6 class="mb-0">{{ getVerificationDisplayName(key) }}</h6>
                  </div>
                  
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <span class="text-muted">Completed</span>
                    <span class="fw-medium text-success">{{ verificationTypeStats[key]?.completed || 0 }}</span>
                  </div>
                  <div class="progress progress-sm mb-2">
                    <div class="progress-bar bg-success" role="progressbar" 
                         [style.width.%]="dashboardStats.totalCandidates > 0 ? (verificationTypeStats[key]?.completed / dashboardStats.totalCandidates) * 100 : 0"></div>
                  </div>
                  
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <span class="text-muted">Pending</span>
                    <span class="fw-medium text-warning">{{ verificationTypeStats[key]?.pending || 0 }}</span>
                  </div>
                  <div class="progress progress-sm mb-2">
                    <div class="progress-bar bg-warning" role="progressbar" 
                         [style.width.%]="dashboardStats.totalCandidates > 0 ? (verificationTypeStats[key]?.pending / dashboardStats.totalCandidates) * 100 : 0"></div>
                  </div>
                  
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <span class="text-muted">Failed</span>
                    <span class="fw-medium text-danger">{{ verificationTypeStats[key]?.failed || 0 }}</span>
                  </div>
                  <div class="progress progress-sm">
                    <div class="progress-bar bg-danger" role="progressbar" 
                         [style.width.%]="dashboardStats.totalCandidates > 0 ? (verificationTypeStats[key]?.failed / dashboardStats.totalCandidates) * 100 : 0"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Candidate Verification Status Table -->
  <!-- <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex align-items-center justify-content-between">
            <h4 class="card-title mb-0">Candidate Verification Status</h4>
            <div class="d-flex">
              <select class="form-select me-3" [(ngModel)]="statusFilter" (change)="filterCandidates()" style="width: auto;">
                <option value="All Status">All Status</option>
                <option value="COMPLETED">Completed</option>
                <option value="IN-PROGRESS">In Progress</option>
                <option value="PENDING">Pending</option>
                <option value="FAILED">Failed</option>
              </select>
              <input type="text" class="form-control" placeholder="Search candidates..." 
                     [(ngModel)]="searchTerm" (input)="filterCandidates()" style="width: 200px;">
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-centered table-nowrap table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Candidate</th>
                  <th>Employee ID</th>
                  <th>Location</th>
                  <th>Case Date</th>
                  <th>Overall Status</th>
                  <th>Progress</th>
                  <th *ngFor="let key of getVerificationKeys()">{{ getVerificationDisplayName(key).split(' ')[0] }}</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let candidate of filteredCandidates; index as i">
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="avatar-sm rounded-circle {{ getAvatarClass(i) }} flex-shrink-0 me-3">
                        <span class="avatar-title text-white font-size-14">{{ getInitials(candidate.name) }}</span>
                      </div>
                      <div>
                        <h6 class="mb-0 font-size-14">{{ candidate.name }}</h6>
                      </div>
                    </div>
                  </td>
                  <td>{{ candidate.employeeId }}</td>
                  <td>{{ candidate.location }}</td>
                  <td>{{ candidate.caseDate }}</td>
                  <td>
                    <span class="badge {{ getStatusClass(candidate.overallStatus) }} font-size-11">
                      {{ candidate.overallStatus.replace('-', ' ') }}
                    </span>
                  </td>
                  <td>
                    <div class="progress progress-sm">
                      <div class="progress-bar {{ getProgressClass(candidate.progress) }}" role="progressbar" 
                           [style.width.%]="candidate.progress" [attr.aria-valuenow]="candidate.progress" 
                           aria-valuemin="0" aria-valuemax="100">
                      </div>
                    </div>
                    <small class="text-muted">{{ candidate.progress }}%</small>
                  </td>
                  <td *ngFor="let key of getVerificationKeys()">
                    <i [class]="getVerificationIconClass(candidate.verifications[key])"></i>
                  </td>
                  <td>
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-soft-primary btn-sm" (click)="viewCandidate(candidate)" 
                              data-bs-toggle="tooltip" title="View">
                        <i class="mdi mdi-eye font-size-12"></i>
                      </button>
                      <button type="button" class="btn btn-soft-secondary btn-sm" (click)="editCandidate(candidate)" 
                              data-bs-toggle="tooltip" title="Edit">
                        <i class="mdi mdi-pencil font-size-12"></i>
                      </button>
                      <button type="button" class="btn btn-soft-danger btn-sm" (click)="deleteCandidate(candidate)" 
                              data-bs-toggle="tooltip" title="Delete">
                        <i class="mdi mdi-delete font-size-12"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="filteredCandidates.length === 0" class="text-center py-4">
              <p class="text-muted">No candidates found</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> -->
</div>